[package]
name = "godot-wasm"
version = "0.1.0"
edition = "2021"
authors = ["Dheatly23 <71598333+Dheatly23@users.noreply.github.com>"]
license = "Apache-2.0"
publish = false

[lib]
crate-type = ["cdylib"]

[profile.release]
lto = "thin"
codegen-units = 1
opt-level = "z"
panic = "abort"
debug-assertions = false
overflow-checks = false

[dependencies]
scopeguard = "^1.2"
parking_lot = "^0.12"
anyhow = { version = "^1.0", features = ["backtrace"] }
lazy_static = "^1.4"
slab = { version = "^0.4", optional = true }
wasi-common = { version = "^15.0", optional = true }
wasmparser = { version = "^0.115", optional = true }
bytes = { version = "^1.5", optional = true }
wat = { version = "^1.0", optional = true }
async-trait = { version = "^0.1", optional = true }
cfg-if = { version = "^1.0", optional = true }
memchr = { version = "^2.5", optional = true }
camino = { version = "^1.1", optional = true }

[dependencies.godot]
git = "https://github.com/godot-rust/gdext"
rev = "8ec6a229065396b209f14652334455c92063e342"

[dependencies.wasmtime]
version = "^15.0"
default-features = false
features = [
  "cranelift",
  "wat",
  "parallel-compilation",
]

[dependencies.wasmtime-wasi]
version = "^15.0"
optional = true
default-features = false
features = [
  "sync",
]

[dependencies.once_cell]
version = "^1.18"
features = [
  "parking_lot",
]

[features]
default = ["epoch-timeout", "memory-limiter", "wasi"]
memory-limiter = []
epoch-timeout = []
object-registry-compat = ["dep:slab"]
object-registry-extern = []
object-registry = ["object-registry-compat", "object-registry-extern"]
more-precise-timer = []
deterministic-wasm = []
wasi = [
  "dep:wasmtime-wasi",
  "dep:wasi-common",
  "dep:async-trait",
  "dep:cfg-if",
  "dep:memchr",
  "dep:camino",
]
wasi-preview2 = [
  "dep:wasmparser",
  "dep:wat",
  "dep:bytes",
  "wasi",
  "wasmtime/component-model",
  "wasmtime-wasi/preview2",
  "wasmtime-wasi/preview1-on-preview2",
]

[workspace]
members = [
  "example/wasm/*",
]
exclude = [
  "example/wasm/.cargo",
]
